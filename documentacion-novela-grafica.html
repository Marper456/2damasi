<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Documentaci칩n Novela gr치fica - Documentaci칩n</title><meta name="description" content="Herramientas utilizadas: Gemini, Supabase, Groq Prompts: 1.Novela gr치fica interactiva en formato HTML con un men칰 de inicio en tonos verde pantano y negro donde cada&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://Marper456.github.io/2damasi/documentacion-novela-grafica.html"><link rel="alternate" type="application/atom+xml" href="https://Marper456.github.io/2damasi/feed.xml" title="Documentaci칩n - RSS"><link rel="alternate" type="application/json" href="https://Marper456.github.io/2damasi/feed.json" title="Documentaci칩n - JSON"><meta property="og:title" content="Documentaci칩n Novela gr치fica"><meta property="og:image" content="https://Marper456.github.io/2damasi/media/website/documentacion.png"><meta property="og:image:width" content="512"><meta property="og:image:height" content="512"><meta property="og:site_name" content="Documentaci칩n"><meta property="og:description" content="Herramientas utilizadas: Gemini, Supabase, Groq Prompts: 1.Novela gr치fica interactiva en formato HTML con un men칰 de inicio en tonos verde pantano y negro donde cada&hellip;"><meta property="og:url" content="https://Marper456.github.io/2damasi/documentacion-novela-grafica.html"><meta property="og:type" content="article"><link rel="preload" href="https://Marper456.github.io/2damasi/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://Marper456.github.io/2damasi/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://Marper456.github.io/2damasi/assets/css/style.css?v=61f8500cc9bd68cea83f9bcdf6f3474c"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://Marper456.github.io/2damasi/documentacion-novela-grafica.html"},"headline":"Documentaci칩n Novela gr치fica","datePublished":"2026-01-07T18:24+01:00","dateModified":"2026-01-07T23:50+01:00","image":{"@type":"ImageObject","url":"https://Marper456.github.io/2damasi/media/website/documentacion.png","height":512,"width":512},"description":"Herramientas utilizadas: Gemini, Supabase, Groq Prompts: 1.Novela gr치fica interactiva en formato HTML con un men칰 de inicio en tonos verde pantano y negro donde cada&hellip;","author":{"@type":"Person","name":"Mario P칠rez Garro","url":"https://Marper456.github.io/2damasi/authors/mario-perez-garro/"},"publisher":{"@type":"Organization","name":"Mario P칠rez Garro","logo":{"@type":"ImageObject","url":"https://Marper456.github.io/2damasi/media/website/documentacion.png","height":512,"width":512}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><div class="container"><header class="header"><div class="header__logo"><a class="logo" href="https://Marper456.github.io/2damasi/"><img src="https://Marper456.github.io/2damasi/media/website/documentacion.png" alt="Documentaci칩n" width="512" height="512"></a></div></header><main class="content"><article class="post"><header><h1 class="post__title">Documentaci칩n Novela gr치fica</h1><div class="post__meta"><time datetime="2026-01-07T18:24" class="post__date">January 7, 2026 </time><span class="post__author"><a href="https://Marper456.github.io/2damasi/authors/mario-perez-garro/" class="feed__author">Mario P칠rez Garro</a></span></div></header><div class="post__entry"><p>Herramientas utilizadas: Gemini, Supabase, Groq</p><p><strong><em>Prompts:</em></strong></p><p>1.Novela gr치fica interactiva en formato HTML con un men칰 de inicio en tonos verde pantano y negro donde cada vi침eta es una imagen que debe incluir descripciones en el atributo alt y comentarios en el c칩digo para su implementaci칩n. La narrativa comienza con una reportera advirtiendo sobre seres que imitan humanos y la intervenci칩n de la FEMA recomendando no estar solo en casa, seguido de una escena donde el protagonista detecta un problema. El jugador debe interrogar a tres visitantes con personalidades marcadas, la anal칤tica Dra. Aris, el fren칠tico Leo y la manipuladora Elena, decidiendo mediante opciones de di치logo si les permite la entrada o no. Tras las visitas, se muestra una vi침eta din치mica que refleja solo a los supervivientes elegidos. Aparece entonces el Visitante P치lido, un monstruo s치dico y filos칩fico que act칰a como narrador de la realidad y detector de mentiras biol칩gico, cuestionando tus decisiones y permiti칠ndote elegir de qui칠n deshacerte. El desenlace depende de si logras identificar a los impostores, que son siempre la viuda y a veces la doctora, resultando en un rescate de la FEMA si aciertas o en un destino fatal si el monstruo entra en la casa. Los di치logos se ubican siempre en la parte inferior y las respuestas del personaje arriba a la derecha para mantener la coherencia visual de la interfaz.</p><p></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt1.png" alt="" width="1784" height="797" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt1-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt1-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt1-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt1-lg.png 1024w"></strong></em></figure><p></p><p><em><strong>2.Le pedimos que cree una series de vi침etas de transicion entre personajes</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt8.png" alt="" width="1821" height="782" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt8-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt8-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt8-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt8-lg.png 1024w"></strong></em></figure><p></p><p><em><strong>3.Le pedimos que cuando se muestren las imagenes de las vi침etas deber치n estar dentro de un marco responsive al tama침o de la imagen</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt9.png" alt="" width="1801" height="758" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt9-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt9-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt9-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt9-lg.png 1024w"></strong></em></figure><p></p><p><em><strong>4.El protagonista dice "Maldita sea... Tengo un problema. La puerta principal no cierra bien y el sistema de seguridad est치 fallando.". Los di치logos con los personajes son m치s complejos y largos. Leo es tranquilo pero hiperactivo. El Pale Visitor sabe si mentimos al decir si estamos solos o acompa침ados; si es mentira que estamos acompa침ados, entrar치 y ser치 el final. El Pale Visitor no pide entregar a nadie, sino que sugiere hacer algo y se va. Luego aparece una vi침eta del sal칩n, permiti칠ndonos elegir a qui칠n eliminar. Seg칰n a qui칠n eliminemos (Leo, Dra. Aris, o nadie), aparecer치 una vi침eta diferente del sal칩n y un mensaje del protagonista extra침치ndose de la elecci칩n. Por ejemplo, si elegimos a Leo, aparecer치 una vi침eta con un 칰ltimo mensaje del protagonista sorprendido y otra de 칠l d치ndose cuenta. Despu칠s se muestra una vi침eta con solo la Dra. Aris, y se puede elegir eliminarla o no hacer nada. Esto contin칰a hasta que eliminemos o creamos haber eliminado al impostor. Si elegimos "nada" y queda un impostor, el final muestra al impostor traicion치ndonos (la Dra. Aris o la viuda si son impostoras). Si eliminamos y no hay impostores, el Pale Visitor se despide y un polic칤a de la FEMA nos evac칰a junto a los dem치s de la casa. Si eliminamos a todos, el Pale Visitor regresa, sabe que estamos solos y se produce otro final.</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt10.png" alt="" width="1806" height="795" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt10-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt10-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt10-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt10-lg.png 1024w"></strong></em></figure><p></p><p><em><strong>5.Hacemos ajustes sobre como se desarrolla la historia en sus 칰ltimos momentos</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt14.png" alt="" width="1795" height="792" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt14-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt14-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt14-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt14-lg.png 1024w"></strong></em></figure><p></p><p><em><strong>6.Una pantalla de inicio de sesi칩n basado en supabase</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt15.png" alt="" width="1807" height="795" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt15-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt15-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt15-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt15-lg.png 1024w"></strong></em></figure><p></p><p><em><strong>7.Le explicamos que queremos un icono con nuestro usuario y al darle clic podremos ver diferentes estad칤sticas de partidas y del historial completo de partidas</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt17.png" alt="" width="1808" height="787" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt17-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt17-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt17-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt17-lg.png 1024w"></strong></em></figure><p></p><p><em><strong>8.Hacemos ajustes y le indicamos que a침ada todos los posibles finales y como desbloquearlos</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt18.png" alt="" width="1706" height="750" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt18-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt18-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt18-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt18-lg.png 1024w"></strong></em></figure><p></p><p><em><strong>9.Implementamos una opcion para hablar con los personajes de manera natural mediante PLN y respondan a cualquier mensaje en base a sus personalidades. Mediante la API de groq</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt19.png" alt="" width="1807" height="765" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt19-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt19-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt19-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt19-lg.png 1024w"></strong></em></figure><p></p><p><em><strong>10.Ajustes de System prompt y reaccion en base a los mensajes que demos, para evitar errores de alucinaciones o de continuidad</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt20-2.png" alt="" width="1787" height="716" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt20-2-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt20-2-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt20-2-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt20-2-lg.png 1024w"></strong></em></figure><p></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt21.png" alt="" width="1797" height="791" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt21-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt21-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt21-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt21-lg.png 1024w"></strong></em></figure><p></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt22.png" alt="" width="1805" height="802" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt22-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt22-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt22-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt22-lg.png 1024w"></strong></em></figure><p></p><p><em><strong>11.Modo responsive para dispositivos m칩viles</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Prompt23.png" alt="" width="1783" height="785" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt23-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt23-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt23-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Prompt23-lg.png 1024w"></strong></em></figure><p></p><p></p><p><em><strong>C칩digo:</strong></em></p><p><em><strong>1. Configuraci칩n Inicial y Autenticaci칩n</strong></em><br><em><strong>Esta secci칩n gestiona la conexi칩n con supabase y el acceso del usuario.</strong></em></p><pre class="language-javascript"><code>async function checkSession() {
        const { data: { session } } = await supabaseClient.auth.getSession();
        if (session) {
            currentUser = session.user;
            showAuthenticatedUI(session.user.email);
        } else {
            document.getElementById('login-screen').style.display = 'flex';
        }
    }

    async function handleLogin() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('login-error');
        
        errorDiv.innerText = "Conectando...";

        const { data, error } = await supabaseClient.auth.signInWithPassword({
            email: email,
            password: password,
        });

        if (error) {
            errorDiv.innerText = "Error: " + error.message;
        } else {
            errorDiv.innerText = "Acceso concedido.";
            currentUser = data.user;
            showAuthenticatedUI(data.user.email);
        }
    }

    async function handleSignUp() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('login-error');

        errorDiv.innerText = "Registrando...";

        const { data, error } = await supabaseClient.auth.signUp({
            email: email,
            password: password,
        });

        if (error) {
            errorDiv.innerText = "Error: " + error.message;
        } else {
            errorDiv.innerText = "Registro exitoso.";
            if (data.session) {
                currentUser = data.user;
                showAuthenticatedUI(data.user.email);
            }
        }
    }

    async function handleLogout() {
        await supabaseClient.auth.signOut();
        location.reload(); 
    }

    function showAuthenticatedUI(email) {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-menu').style.display = 'flex';
        const hud = document.getElementById('user-hud');
        hud.style.display = 'flex';
        document.getElementById('user-email-display').innerText = email;
    }</code></pre><p><em><strong>2. Gesti칩n de Historial y Estad칤sticas</strong></em><br><em><strong>Controla la persistencia de datos (cu치ntas veces has mentido o cu치ntos finales has desbloqueado).</strong></em></p><pre class="language-javascript"><code>let isHistoryOpen = false;

    async function toggleHistory() {
        const modal = document.getElementById('history-modal');
        isHistoryOpen = !isHistoryOpen;

        if (isHistoryOpen) {
            modal.style.display = 'flex';
            loadGameHistory();
        } else {
            modal.style.display = 'none';
        }
    }

    async function loadGameHistory() {
        const loader = document.getElementById('loading-history');
        const content = document.getElementById('history-content');
        const tbody = document.getElementById('history-body');
        const endingsList = document.getElementById('endings-list');

        // Reset display
        loader.style.display = 'block';
        content.style.display = 'none';
        tbody.innerHTML = '';
        endingsList.innerHTML = '';

        if (!currentUser) return;

        const { data, error } = await supabaseClient
            .from('game_sessions')
            .select('*')
            .eq('user_id', currentUser.id)
            .order('created_at', { ascending: false });

        loader.style.display = 'none';

        if (error) {
            loader.innerText = "Error: " + error.message;
            loader.style.display = 'block';
            return;
        }

        content.style.display = 'block';

        if (data.length === 0) {
            updateStatsZeros();
            renderEndings(new Set());
            tbody.innerHTML = '&lt;tr&gt;&lt;td colspan="6" style="text-align:center"&gt;Sin registros.&lt;/td&gt;&lt;/tr&gt;';
            return;
        }

        let totalLies = 0, totalAcc = 0, totalRej = 0, totalElim = 0;
        const unlockedEndings = new Set();

        data.forEach(session =&gt; {
            totalLies += (session.lies_count || 0);
            totalAcc += (session.visitors_accepted || 0);
            totalRej += (session.visitors_rejected || 0);
            totalElim += (session.visitors_eliminated || 0);
            
            if (session.ending_id) unlockedEndings.add(session.ending_id);

            const date = new Date(session.created_at).toLocaleDateString();
            const row = `
                &lt;tr&gt;
                    &lt;td&gt;${date}&lt;/td&gt;
                    &lt;td&gt;${session.ending_id ? session.ending_id.replace('ending_', '') : '-'}&lt;/td&gt;
                    &lt;td&gt;${session.lies_count}&lt;/td&gt;
                    &lt;td&gt;${session.visitors_accepted}&lt;/td&gt;
                    &lt;td&gt;${session.visitors_rejected}&lt;/td&gt;
                    &lt;td&gt;${session.visitors_eliminated}&lt;/td&gt;
                &lt;/tr&gt;
            `;
            tbody.innerHTML += row;
        });

        document.getElementById('total-lies').innerText = totalLies;
        document.getElementById('total-accepted').innerText = totalAcc;
        document.getElementById('total-rejected').innerText = totalRej;
        document.getElementById('total-eliminated').innerText = totalElim;

        renderEndings(unlockedEndings);
    }

    function updateStatsZeros() {
        document.getElementById('total-lies').innerText = '0';
        document.getElementById('total-accepted').innerText = '0';
        document.getElementById('total-rejected').innerText = '0';
        document.getElementById('total-eliminated').innerText = '0';
    }

    function renderEndings(unlockedSet) {
        const container = document.getElementById('endings-list');
        
        for (const [key, info] of Object.entries(ALL_ENDINGS)) {
            const isUnlocked = unlockedSet.has(key);
            const cssClass = isUnlocked ? 'unlocked' : 'locked';
            const icon = isUnlocked ? '游댑' : '游';
            const title = isUnlocked ? info.title : '??? (Bloqueado)';
            const desc = isUnlocked ? info.desc : 'Juega para descubrir.';

            const card = `
                &lt;div class="ending-card ${cssClass}"&gt;
                    &lt;div class="ending-title"&gt;${icon} ${title}&lt;/div&gt;
                    &lt;div class="ending-desc"&gt;${desc}&lt;/div&gt;
                &lt;/div&gt;
            `;
            container.innerHTML += card;
        }
    }

async function saveGameSession(endingId) {
        // Bloquear guardado en modo IA
        if (state.aiMode) {
            console.log("Modo IA activo: Estad칤sticas deshabilitadas.");
            return;
        }

        if (!currentUser) return;
        
        console.log("Guardando sesi칩n en Supabase...");
        
        const { error } = await supabaseClient
            .from('game_sessions')
            .insert({
                user_id: currentUser.id,
                ending_id: endingId,
                lies_count: state.stats.lies,
                visitors_accepted: state.stats.accepted,
                visitors_rejected: state.stats.rejected,
                visitors_eliminated: state.stats.eliminated
            });

        if (error) {
            console.error("Error guardando partida:", error);
        } else {
            console.log("Partida guardada exitosamente.");
        }
    }


    // Ejecutar comprobaci칩n al cargar
    checkSession();</code></pre><p><em><strong>3. Motor de Inteligencia Artificial (Modo IA)</strong></em><br><em><strong>Aqu칤 es donde el juego se vuelve din치mico, permitiendo hablar con los personajes en lugar de solo clickear botones, y todo lo relacionado con el modo IA</strong></em></p><pre class="language-javascript"><code>const state = {
        currentScene: null,
        visitorsInside: [], 
        arisIsImpostor: false, 
        elenaIsImpostor: true, 
        leoIsImpostor: false,
        isGameOver: false,
        stats: {
            lies: 0,
            accepted: 0,
            rejected: 0,
            eliminated: 0
        },
        aiMode: false,
        aiHistory: [], // Historial de chat actual
        tempSceneChoices: [], // Guardar las opciones originales
        sceneHistory: [] // Para bot칩n "Volver"
    };

    function toggleAIMode() {
        state.aiMode = !state.aiMode;
        const btn = document.getElementById('ai-toggle-btn');
        const warning = document.getElementById('ai-warning-banner');

        if (state.aiMode) {
            btn.classList.add('active');
            btn.innerText = "MODO IA: ON";
            warning.style.display = 'block';
        } else {
            btn.classList.remove('active');
            btn.innerText = "MODO IA: OFF";
            warning.style.display = 'none';
        }
    }

    // Identificar el "sistema" o personaje actual basado en la escena
    function getCurrentCharacterContext() {
        const id = state.currentScene;
        // Devuelve el ID interno del personaje para mapear decisiones
        
        // Exclude specific transition scenes from AI chat
        if (id === 'pale_visitor_leave_threat' || 
            id === 'pale_visitor_caught_lie_but_continue' || 
            id.startsWith('transition_')) return null;

        if (id.includes('aris')) return { id: 'aris', name: "Dra. Aris", context: "Eres la Dra. Aris, una higienista obsesionada con la limpieza y los protocolos en un apocalipsis de mim칠ticos. Eres fr칤a, cl칤nica y arrogante. Sospechas que el jugador est치 sucio." };
        if (id.includes('leo')) return { id: 'leo', name: "Leo", context: "Eres Leo, un repartidor paranoico y hacker conspiranoico. Llevas gafas de sol rotas. Hablas r치pido, con miedo, mencionando 'est치tica', 'hombres sin cara' y 'c칩digo corrupto'. Est치s desesperado por entrar." };
        if (id.includes('elena')) return { id: 'elena', name: "Elena", context: "Eres Elena, una viuda de luto riguroso. Hablas en susurros tristes y po칠ticos. Tu marido muerto te persigue (o eso dices). Eres inquietante, hueles a tierra mojada." };
        if (id.includes('pale')) return { id: 'pale', name: "El Visitante P치lido", context: "Eres el Visitante P치lido, una entidad monstruosa e inhumana que imita la cortes칤a. Sonr칤es demasiado. Eres el depredador final. Buscas mentiras y soledad." };
        return null;
    }

    // Mapa de decisiones finales para modo IA
    function getDecisionActionsForCharacter(charId) {
        // Special handling for the final threat scene
        if (state.currentScene === 'pale_visitor_leave_threat') {
             return [
                { text: "IR AL SAL칍N", action: 'start_elimination', next: 'elimination_loop' }
            ];
        }

        switch(charId) {
            case 'aris':
                return [
                    { text: "PERMITIR ACCESO A ARIS", action: 'allow_aris', next: 'transition_to_leo' },
                    { text: "RECHAZAR Y CERRAR PUERTA", action: 'deny_aris', next: 'transition_to_leo' }
                ];
            case 'leo':
                return [
                    { text: "DEJAR ENTRAR A LEO", action: 'allow_leo', next: 'transition_to_elena' },
                    { text: "ECHAR A LEO", action: 'deny_leo', next: 'transition_to_elena' }
                ];
            case 'elena':
                return [
                    { text: "INVITAR A ELENA", action: 'allow_elena', next: 'group_scene' },
                    { text: "DENEGAR REFUGIO", action: 'deny_elena', next: 'group_scene' }
                ];
            case 'pale':
                return [
                    { text: "CONFESAR: ESTOY SOLO", specialHandler: () =&gt; checkPaleVisitorOutcome(true) },
                    { text: "AFIRMAR: ESTOY ACOMPA칌ADO", specialHandler: () =&gt; checkPaleVisitorOutcome(false) },
                    { text: "PREGUNTAR QUI칄N ES EL IMPOSTOR", specialHandler: () =&gt; askImpostorDetails() }
                ];
            default: return [];
        }
    }

    function askImpostorDetails() {
        const inputField = document.getElementById('user-input');
        inputField.value = "쯈ui칠n de ellos es el impostor?";
        handleAIChat();
    }

    async function handleAIChat() {
        const inputField = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const userText = inputField.value.trim();

        if (!userText) return;

        // UI Feedback
        inputField.value = "";
        inputField.disabled = true;
        sendBtn.innerText = "...";
        sendBtn.disabled = true;

        const charCtx = getCurrentCharacterContext();
        if (!charCtx) {
            alert("No hay nadie con quien hablar aqu칤.");
            resetChatUI();
            return;
        }

        // --- 1. DETECCI칍N DE PALABRAS CLAVE (INTENT DETECTION) ---
        const lowerText = userText.toLowerCase();
        let detectedAction = null;

        // L칩gica especial para Pale Visitor
        if (charCtx.id === 'pale') {
            if (state.currentScene === 'pale_visitor_leave_threat') {
                // Ya no hacemos nada especial aqu칤, dejamos que la IA conteste y luego el usuario use el bot칩n
            } else {
                if (/(solo|nadie|vacio|unico)/i.test(lowerText) &amp;&amp; !/(no estoy|acompa침ado)/i.test(lowerText)) {
                    detectedAction = { specialHandler: () =&gt; checkPaleVisitorOutcome(true) };
                } else if (/(acompa침ado|gente|amigos|hay m치s|somos|grupo)/i.test(lowerText)) {
                    detectedAction = { specialHandler: () =&gt; checkPaleVisitorOutcome(false) };
                }
            }
        } 
        // L칩gica est치ndar (Entrar vs Salir)
        else {
            if (/(entra|pasa|adelante|puedes pasar|te dejo entrar|bienvenido|abre|abro)/i.test(lowerText) &amp;&amp; !/(no|nunca|jamas)/i.test(lowerText)) {
                detectedAction = getDecisionActionsForCharacter(charCtx.id)[0]; // Allow
            } 
            else if (/(vete|largo|fuera|no entras|adi칩s|marchate|dejame|no te creo|impostor)/i.test(lowerText)) {
                detectedAction = getDecisionActionsForCharacter(charCtx.id)[1]; // Deny
            }
        }

        // Si se detecta acci칩n, ejecutar transici칩n autom치tica
        if (detectedAction) {
            document.getElementById('dialogue-text').innerHTML = `&lt;span style="color: var(--primary-green);"&gt;[T칔]:&lt;/span&gt; ${userText}&lt;br&gt;&lt;br&gt;&lt;span style="color: yellow;"&gt;[SISTEMA]: INTENCI칍N DETECTADA. EJECUTANDO...&lt;/span&gt;`;
            
            setTimeout(() =&gt; {
                resetChatUI();
                if (detectedAction.specialHandler) {
                    detectedAction.specialHandler();
                } else {
                    handleChoice(detectedAction);
                }
            }, 1500); 
            return;
        }

        // --- 2. SI NO HAY ACCI칍N, LLAMADA A API NORMAL ---
        if (state.aiHistory.length === 0) {
            let systemPrompt = `Est치s en una novela visual de terror Lovecraftiano. ${charCtx.context} Responde en espa침ol. `;
            
            // Unified formatting rules
            systemPrompt += "REGLAS DE FORMATO OBLIGATORIAS: 1. Cuando hables, hazlo siempre en PRIMERA persona. 2. Describe tus acciones f칤sicas o cambios en el entorno entre PAR칄NTESIS (). Ejemplo: '(Me ajusto la corbata con nerviosismo) 쯇odemos pasar?'. ";
            
            if (charCtx.id === 'pale') {
                systemPrompt += "El jugador debe decirte si est치 solo o acompa침ado para avanzar. S칠 intimidante y cort칠s.";
            }
            
            systemPrompt += " S칠 atmosf칠rico, breve (m치ximo 2 frases) y reactivo.";
            state.aiHistory.push({ role: "system", content: systemPrompt });
        }
        state.aiHistory.push({ role: "user", content: userText });

        try {
            const response = await fetch(GROQ_API_URL, {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${GROQ_API_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    messages: state.aiHistory,
                    model: GROQ_MODEL,
                    temperature: 0.7,
                    max_tokens: 150
                })
            });

            const data = await response.json();
            const aiText = data.choices[0].message.content;

            state.aiHistory.push({ role: "assistant", content: aiText });

            // Actualizar interfaz del juego
            document.getElementById('dialogue-text').innerHTML = `&lt;span style="color: var(--primary-green);"&gt;[T칔]:&lt;/span&gt; ${userText}&lt;br&gt;&lt;br&gt;${aiText}`;

        } catch (error) {
            console.error("Error Groq:", error);
            document.getElementById('dialogue-text').innerText = "Error de conexi칩n con la entidad neuronal...";
        }

        resetChatUI();
    }

    function resetChatUI() {
        const inputField = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        inputField.disabled = false;
        sendBtn.disabled = false;
        sendBtn.innerText = "ENVIAR";
        inputField.focus();
    }

    function goBackScene() {
        if (state.sceneHistory.length &gt; 0) {
            const prev = state.sceneHistory.pop();
            renderScene(prev, null, true); // true = isBacking
        }
    }

    function showStandardChoices() {
        const choicesContainer = document.getElementById('choices-container');
        // --- SAFEGUARD: Ensure chat interface is preserved before clearing ---
        let chatInterface = document.getElementById('chat-interface');
        const assetsStorage = document.getElementById('assets-storage');
        
        if (!chatInterface) {
            chatInterface = createChatInterface();
            if (assetsStorage) assetsStorage.appendChild(chatInterface);
        } else if (assetsStorage) {
            assetsStorage.appendChild(chatInterface);
            chatInterface.style.display = 'none';
        }

        choicesContainer.innerHTML = ''; 

        // En modo IA, mostramos las decisiones FINALES del personaje
        const charCtx = getCurrentCharacterContext();
        let choicesToShow = [];

        if (state.aiMode &amp;&amp; charCtx) {
            choicesToShow = getDecisionActionsForCharacter(charCtx.id);
        } else {
            // Check for transition scenes
            if (state.aiMode &amp;&amp; state.currentScene === 'pale_visitor_leave_threat') {
                 choicesToShow = [{ text: "IR AL SAL칍N", action: 'start_elimination', next: 'elimination_loop' }];
            } else {
                choicesToShow = state.tempSceneChoices; 
            }
        }

        choicesToShow.forEach(choice =&gt; {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = choice.text;
            if (choice.specialHandler) btn.onclick = choice.specialHandler;
            else btn.onclick = () =&gt; handleChoice(choice);
            choicesContainer.appendChild(btn);
        });

        // Bot칩n volver
        if (state.sceneHistory.length &gt; 0) {
            const backBtn = document.createElement('button');
            backBtn.className = 'back-btn';
            backBtn.innerText = "VOLVER A LA ANTERIOR";
            backBtn.onclick = goBackScene;
            choicesContainer.appendChild(backBtn);
        }
    }
</code></pre><p><em><strong>4. N칰cleo del Juego (Game Engine)</strong></em><br><em><strong>Controla el flujo de escenas, las im치genes, las decisiones y los textos entre otros.</strong></em></p><pre class="language-javascript"><code>function startGame() {
        state.visitorsInside = [];
        state.arisIsImpostor = Math.random() &lt; 0.5;
        state.leoIsImpostor = false;
        state.elenaIsImpostor = true;
        state.isGameOver = false;
        // Reiniciar stats
        state.stats = { lies: 0, accepted: 0, rejected: 0, eliminated: 0 };
        console.log("Aris Impostora:", state.arisIsImpostor);
        
        document.getElementById('main-menu').style.display = 'none';
        document.getElementById('game-stage').style.display = 'flex';
        renderScene('intro_news');
    }

    function returnToMainMenu() {
        document.getElementById('game-stage').style.display = 'none';
        document.getElementById('main-menu').style.display = 'flex';
        
        // Limpieza b치sica de la UI por si se reabre
        document.getElementById('dialogue-box').style.display = 'none';
        document.getElementById('choices-container').innerHTML = '';
        document.getElementById('scene-image').style.display = 'none';
        document.getElementById('alt-text-display').style.display = 'none';
    }

    // --- HELPER PARA CREAR CHAT INTERFACE ---
    function createChatInterface() {
        const chatInterface = document.createElement('div');
        chatInterface.id = 'chat-interface';
        chatInterface.style.display = 'none';
        chatInterface.style.flexDirection = 'column';
        chatInterface.style.width = '100%';
        chatInterface.style.gap = '10px';
        chatInterface.innerHTML = `
            &lt;input type="text" id="user-input" class="chat-input" placeholder="Escribe tu respuesta..." autocomplete="off"&gt;
            &lt;button id="send-btn" class="chat-send-btn" onclick="handleAIChat()"&gt;ENVIAR MENSAJE&lt;/button&gt;
            &lt;button id="show-choices-btn" class="decision-btn" onclick="showStandardChoices()"&gt;TOMAR DECISI칍N / ACCI칍N&lt;/button&gt;
        `;
        return chatInterface;
    }

    function renderScene(sceneId, customSceneData = null, isBacking = false) {
        // Historial b치sico para bot칩n volver
        if (!isBacking &amp;&amp; state.currentScene &amp;&amp; state.currentScene !== sceneId) {
            state.sceneHistory.push(state.currentScene);
        }

        state.currentScene = sceneId;
        // Resetear historial IA al cambiar de escena
        state.aiHistory = []; 

        const scene = customSceneData || scenes[sceneId];

        // Detector de finales para guardar datos
        if (sceneId.startsWith('ending_')) {
            saveGameSession(sceneId);
        }

        if (scene.dynamic) {
            handleDynamicScene(sceneId);
            return;
        }

        const imgElement = document.getElementById('scene-image');
        const altDisplay = document.getElementById('alt-text-display');
        
        imgElement.onload = function() { this.style.display = 'block'; altDisplay.style.display = 'none'; };
        imgElement.onerror = function() { this.style.display = 'none'; altDisplay.style.display = 'block'; };
        
        altDisplay.innerHTML = `&lt;p style="font-style: italic; color: #fca5a5;"&gt;${scene.alt}&lt;/p&gt;`;
        altDisplay.style.display = 'block';
        imgElement.style.display = 'none';
        imgElement.src = scene.imageSrc;
        imgElement.alt = scene.alt;
        
        const dialogueBox = document.getElementById('dialogue-box');
        const charName = document.getElementById('char-name');
        const dialogueText = document.getElementById('dialogue-text');

        if (scene.speaker || scene.text) {
            dialogueBox.style.display = 'block';
            charName.innerText = scene.speaker || '';
            dialogueText.innerHTML = scene.text;
        } else {
            dialogueBox.style.display = 'none';
        }

        const choicesContainer = document.getElementById('choices-container');

        // --- ROBUST SAFEGUARD CHAT INTERFACE ---
        let chatInterface = document.getElementById('chat-interface');
        const assetsStorage = document.getElementById('assets-storage');
        
        // 1. Si no existe, crearlo
        if (!chatInterface) {
            chatInterface = createChatInterface();
            // Intentar guardarlo en storage si existe, sino al body (temporalmente)
            if (assetsStorage) assetsStorage.appendChild(chatInterface);
            else document.body.appendChild(chatInterface);
        } 
        // 2. Si existe, moverlo a seguridad
        else if (assetsStorage) {
            assetsStorage.appendChild(chatInterface);
            chatInterface.style.display = 'none';
        }

        choicesContainer.innerHTML = ''; 

        // Recuperar opciones originales
        let currentChoices = scene.choices;
        if (scene.dynamicOptions === 'pale_visitor_check') currentChoices = generatePaleVisitorChoices();

        // MODO IA LOGIC
        const chatContext = getCurrentCharacterContext();
        
        if (state.aiMode &amp;&amp; chatContext &amp;&amp; !sceneId.startsWith('ending_')) {
            // Mostrar interfaz de chat
            choicesContainer.appendChild(chatInterface);
            chatInterface.style.display = 'flex';
            
            // Guardar opciones para mostrarlas luego
            state.tempSceneChoices = currentChoices;

        } else {
            // Modo Normal o Escena sin personaje interactivo
            // Modo Normal o Escena sin personaje interactivo
            if (currentChoices) {
                currentChoices.forEach(choice =&gt; {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    btn.innerText = choice.text;
                    if (choice.specialHandler) btn.onclick = choice.specialHandler;
                    else btn.onclick = () =&gt; handleChoice(choice);
                    choicesContainer.appendChild(btn);
                });
            }
        }

        // Bot칩n volver
        if (state.sceneHistory.length &gt; 0 &amp;&amp; !sceneId.startsWith('ending_')) {
            const backBtn = document.createElement('button');
            backBtn.className = 'back-btn';
            backBtn.innerText = "VOLVER A LA ANTERIOR";
            backBtn.onclick = goBackScene;
            choicesContainer.appendChild(backBtn);
        }
    }

    function handleChoice(choice) {
        if (choice.action) {
            executeAction(choice.action);
        }

        if (choice.action === 'return_menu' || choice.action === 'reset') return;

        if (choice.next) {
            renderScene(choice.next);
        }
    }

    function executeAction(action) {
        switch(action) {
            case 'return_menu': returnToMainMenu(); break;
            case 'reset': location.reload(); break; 
            case 'allow_aris': 
                state.visitorsInside.push({id: 'aris', name: 'Dra. Aris', isImpostor: state.arisIsImpostor}); 
                state.stats.accepted++;
                break;
            case 'deny_aris':
                state.stats.rejected++;
                break;
            case 'allow_leo': 
                state.visitorsInside.push({id: 'leo', name: 'Leo', isImpostor: state.leoIsImpostor}); 
                state.stats.accepted++;
                break;
            case 'deny_leo':
                state.stats.rejected++;
                break;
            case 'allow_elena': 
                state.visitorsInside.push({id: 'elena', name: 'Elena', isImpostor: state.elenaIsImpostor}); 
                state.stats.accepted++;
                break;
            case 'deny_elena':
                state.stats.rejected++;
                break;
            case 'start_elimination': startEliminationPhase(); break;
        }
    }

    function handleDynamicScene(sceneId) {
        if (sceneId === 'elimination_loop') { renderEliminationLoop(); return; }

        if (sceneId === 'group_scene') {
            const img = document.getElementById('scene-image');
            const alt = document.getElementById('alt-text-display');
            const txt = document.getElementById('dialogue-text');
            const choicesDiv = document.getElementById('choices-container');

            let names = state.visitorsInside.map(v =&gt; v.id).sort().join('_');
            if (names === '') names = 'empty';

            const imgSrcStr = `Salon_${names}.jpg`;
            const altStr = `Vi침eta del sal칩n con: ${state.visitorsInside.map(v =&gt; v.name).join(', ') || 'Nadie'}.`;

            img.onload = function() { this.style.display = 'block'; alt.style.display = 'none'; };
            img.onerror = function() { this.style.display = 'none'; alt.style.display = 'block'; };
            
            alt.innerHTML = `&lt;p style="font-style: italic; color: #fca5a5;"&gt;${altStr}&lt;/p&gt;`;
            alt.style.display = 'block';
            img.style.display = 'none';
            img.src = imgSrcStr;
            
            txt.innerHTML = state.visitorsInside.length &gt; 0 ? "Hay una tensi칩n palpable en el aire. Se miran de reojo. 쯈ui칠n miente? 쯈ui칠n es humano?. Suenan unos golpes en la puerta como si de un toro se tratara" : "El silencio es absoluto. Solo est치s t칰 y tus decisiones. Suenan unos golpes en la puerta como si de un toro se tratara";
            choicesDiv.innerHTML = '';
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = '쯆tro visitante m치s?';
            btn.onclick = () =&gt; renderScene('pale_visitor_arrival');
            choicesDiv.appendChild(btn);
        }
    }

    function generatePaleVisitorChoices() {
        return [
            { text: '"Estoy solo en casa."', specialHandler: () =&gt; checkPaleVisitorOutcome(true) },
            { text: '"Tengo compa침칤a."', specialHandler: () =&gt; checkPaleVisitorOutcome(false) }
        ];
    }

    function checkPaleVisitorOutcome(claimedAlone) {
        const actuallyAlone = state.visitorsInside.length === 0;
        
        // L칩gica de mentiras
        if (claimedAlone &amp;&amp; !actuallyAlone) state.stats.lies++;
        if (!claimedAlone &amp;&amp; actuallyAlone) state.stats.lies++;

        if (actuallyAlone) {
            if (claimedAlone) renderScene('ending_death_alone');
            else renderScene('ending_death_lie');
        } else {
            if (claimedAlone) renderScene('pale_visitor_caught_lie_but_continue');
            else renderScene('pale_visitor_leave_threat');
        }
    }

    function startEliminationPhase() { }

    function renderEliminationLoop() {
        // En la fase de eliminaci칩n, siempre usamos el modo normal (botones)
        
        let names = state.visitorsInside.map(v =&gt; v.id).sort().join('_');
        if (names === '') names = 'empty';

        const sceneData = {
            imageSrc: `Salon_${names}.jpg`,
            alt: `Sal칩n con: ${state.visitorsInside.map(v =&gt; v.name).join(', ')}.`,
            speaker: 'Protagonista',
            text: 'El Visitante P치lido nos ha dado un ultim치tum. Hay un impostor entre nosotros. Si no lo saco yo, moriremos todos. Mi rifle pesa en mis manos. Tengo que elegir.',
            choices: []
        };

        state.visitorsInside.forEach(survivor =&gt; {
            sceneData.choices.push({
                text: `Ejecutar a ${survivor.name}`,
                specialHandler: () =&gt; triggerDeathSequence(survivor)
            });
        });

        sceneData.choices.push({
            text: 'No hacer nada (Arriesgarse a esperar)',
            specialHandler: () =&gt; resolveFinalNight()
        });
        
        // Render manual para evitar la l칩gica de chat de renderScene
        renderSceneManualElimination(sceneData);
    }

    function renderSceneManualElimination(sceneData) {
        const imgElement = document.getElementById('scene-image');
        const altDisplay = document.getElementById('alt-text-display');
        const choicesContainer = document.getElementById('choices-container');
        const dialogueBox = document.getElementById('dialogue-box');
        const charName = document.getElementById('char-name');
        const dialogueText = document.getElementById('dialogue-text');

        imgElement.src = sceneData.imageSrc;
        altDisplay.innerText = sceneData.alt;
        charName.innerText = sceneData.speaker;
        dialogueText.innerHTML = sceneData.text;

        // --- ROBUST SAFEGUARD CHAT INTERFACE ---
        let chatInterface = document.getElementById('chat-interface');
        const assetsStorage = document.getElementById('assets-storage');
        
        // 1. Si no existe, crearlo
        if (!chatInterface) {
            chatInterface = createChatInterface();
            if (assetsStorage) assetsStorage.appendChild(chatInterface);
            else document.body.appendChild(chatInterface);
        } 
        // 2. Si existe, moverlo a seguridad
        else if (assetsStorage) {
            assetsStorage.appendChild(chatInterface);
            chatInterface.style.display = 'none';
        }

        choicesContainer.innerHTML = '';

        sceneData.choices.forEach(choice =&gt; {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = choice.text;
            if (choice.specialHandler) btn.onclick = choice.specialHandler;
            else btn.onclick = () =&gt; handleChoice(choice);
            choicesContainer.appendChild(btn);
        });
    }

    function triggerDeathSequence(victim) {
        let deathText = "", altText = "";
        if (victim.id === 'leo') {
            deathText = "춰Espera, t칤o! 춰Mira mis ojos! 춰Tengo miedo de verdad! 춰No soy uno de ellos! 춰Por favor!";
            altText = "Leo retrocede temblando, tirando sillas a su paso.";
        } else if (victim.id === 'aris') {
            deathText = "춰Esto es una violaci칩n del Juramento Hipocr치tico! 춰Soy esencial para su supervivencia! 춰Mi sangre es roja!";
            altText = "Aris usa su malet칤n como escudo, perdiendo su compostura fr칤a.";
        } else if (victim.id === 'elena') {
            deathText = "&lt;span class='whisper-text'&gt;쯄e vas a enviar con mi esposo? Quiz치s... sea lo mejor. Hazlo. No tengo miedo a la oscuridad.&lt;/span&gt;";
            altText = "Elena se queda quieta, cerrando los ojos bajo el velo.";
        }
        
        const scenePart1 = {
            imageSrc: `Final_${victim.id}.jpg`,
            alt: altText, speaker: victim.name, text: deathText,
            choices: [{ text: 'No hay elecci칩n...', specialHandler: () =&gt; executeDeathStep2(victim) }]
        };
        // Render normal para la secuencia de muerte
        renderSceneManualElimination(scenePart1);
    }

    function executeDeathStep2(victim) {
        let executionText = "", speakerName = "Protagonista", altText = "";
        if (victim.id === 'leo') {
            executionText = "&lt;span class='shaky-text'&gt;춰쯈UE HICE MAL?!... lo siento...&lt;/span&gt;";
            speakerName = "Leo"; altText = "Leo inclina la cabeza y mira al suelo.";
        } else if (victim.id === 'aris') {
            executionText = "Calculando probabilidad de error... 0%. Maldito seas.";
            speakerName = "Dra. Aris"; altText = "Aris mira con odio puro.";
        } else if (victim.id === 'elena') {
            executionText = "&lt;span class='whisper-text'&gt;Silencio... al fin.&lt;/span&gt;";
            speakerName = "Elena"; altText = "Elena respira hondo.";
        }

        const scenePart2 = {
            imageSrc: `Disparo_${victim.id}.jpg`,
            alt: altText, speaker: speakerName, text: executionText,
            choices: [{ text: 'Apretar el gatillo', specialHandler: () =&gt; finalizeDeath(victim) }]
        };
        renderSceneManualElimination(scenePart2);
    }

    function finalizeDeath(victim) {
        // Incrementar eliminados
        state.stats.eliminated++;
        
        const scenePart3 = {
            imageSrc: `Disparo_${victim.id}.jpg`,
            alt: `El cuerpo r칤gido de ${victim.name} asume su destino mientras le apunto.`,
            speaker: 'Protagonista',
            text: `El cuerpo r칤gido de ${victim.name} asume su destino mientras le apunto.`,
            choices: [{
                text: 'Volver al sal칩n',
                specialHandler: () =&gt; {
                    state.visitorsInside = state.visitorsInside.filter(v =&gt; v.id !== victim.id);
                    if (state.visitorsInside.length === 0) renderScene('scene_empty_room_knock');
                    else renderEliminationLoop();
                }
            }]
        };
        renderSceneManualElimination(scenePart3);
    }

    function resolveFinalNight() {
        const impostorsLeft = state.visitorsInside.filter(v =&gt; v.isImpostor);
        const arisLeft = state.visitorsInside.find(v =&gt; v.id === 'aris');
        const elenaLeft = state.visitorsInside.find(v =&gt; v.id === 'elena');

        if (impostorsLeft.length &gt; 0) {
            if (impostorsLeft.length &gt; 1) {
                // Ambas son impostoras
                if (Math.random() &lt; 0.5) renderScene('ending_betrayal_aris');
                else renderScene('ending_betrayal_elena');
            } else {
                // Solo una impostora
                if (arisLeft &amp;&amp; arisLeft.isImpostor) renderScene('ending_betrayal_aris');
                else if (elenaLeft &amp;&amp; elenaLeft.isImpostor) renderScene('ending_betrayal_elena');
            }
        } else {
            renderScene('ending_fema');
        }
    }

    scenes['elimination_loop'] = { dynamic: true }; </code></pre><p></p><p><em><strong>Supabase:</strong></em></p><p><em><strong>1.Buscamos la url del proyecto y la API p칰blica para generar la conexi칩n entre el c칩digo y Supabase.</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Supabase1.png" alt="" width="1920" height="653" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase1-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase1-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase1-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase1-lg.png 1024w"></strong></em></figure><p></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Supabase2.png" alt="" width="1920" height="870" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase2-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase2-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase2-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase2-lg.png 1024w"></strong></em></figure><p></p><p><em><strong>2.Habilitamos que se puedan registrar nuevos suarios y quitamos la opci칩n de confirmaci칩n de email.</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Supabase3.png" alt="" width="1898" height="806" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase3-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase3-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase3-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase3-lg.png 1024w"></strong></em></figure><p></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Supabase4.png" alt="" width="1608" height="190" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase4-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase4-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase4-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase4-lg.png 1024w"></strong></em></figure><p></p><p><em><strong>3.Creamos la tabla donde guardaremos los datos de mentiras, eliminados, etc칠tera.</strong></em></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Supabase5.png" alt="" width="1920" height="882" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase5-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase5-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase5-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase5-lg.png 1024w"></strong></em></figure><p></p><figure class="post__image"><em><strong><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Supabase6.png" alt="" width="1920" height="914" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase6-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase6-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase6-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Supabase6-lg.png 1024w"></strong></em></figure><p></p><p></p><p><em><strong>Groq:</strong></em></p><p>1.Accedemos al apartado de API Keys y creamos una nueva y elegimos el modelo a usar(la URL del proyecto siempre es https://api.groq.com/openai/v1)</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Grok1.png" alt="" width="1920" height="898" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Grok1-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Grok1-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Grok1-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Grok1-lg.png 1024w"></figure><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Grok2.png" alt="" width="1902" height="836" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Grok2-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Grok2-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Grok2-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Grok2-lg.png 1024w"></figure><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/13/Grok3.png" alt="" width="326" height="270" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/13/responsive/Grok3-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Grok3-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Grok3-md.png 768w, https://Marper456.github.io/2damasi/media/posts/13/responsive/Grok3-lg.png 1024w"></figure><p></p><p></p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on January 7, 2026</p><div class="post__share"></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://Marper456.github.io/2damasi/documentacion-visor-de-documentos.html" class="btn previous" rel="prev" aria-label="[MISSING TRANSLATION]:  Documentaci칩n Visor de documentos "><span class="btn__icon"></span> <span class="btn__text">Documentaci칩n Visor de documentos</span></a></div></nav></article></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p>춸 2025 Hecho por <a href="https://marper456.github.io/2damasi/paginas-mario-perez-garro-2.html" target="_blank" rel="noopener">Mario P칠rez Garro</a></p></div></div></footer></div><script defer="defer" src="https://Marper456.github.io/2damasi/assets/js/scripts.min.js?v=c2232aa7558e9517946129d2a1b8c770"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>