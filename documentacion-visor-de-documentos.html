<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Documentación Visor de documentos - Documentación</title><meta name="description" content="Herramientas utilizadas: Gemini y Supabase Prompts: 1:Le indicamos que queremos un visor de documentos 2.Le indicamos como queremos que se visualice los archivos xlsx, csv..."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://Marper456.github.io/2damasi/documentacion-visor-de-documentos.html"><link rel="alternate" type="application/atom+xml" href="https://Marper456.github.io/2damasi/feed.xml" title="Documentación - RSS"><link rel="alternate" type="application/json" href="https://Marper456.github.io/2damasi/feed.json" title="Documentación - JSON"><meta property="og:title" content="Documentación Visor de documentos"><meta property="og:image" content="https://Marper456.github.io/2damasi/media/website/documentacion.png"><meta property="og:image:width" content="512"><meta property="og:image:height" content="512"><meta property="og:site_name" content="Documentación"><meta property="og:description" content="Herramientas utilizadas: Gemini y Supabase Prompts: 1:Le indicamos que queremos un visor de documentos 2.Le indicamos como queremos que se visualice los archivos xlsx, csv..."><meta property="og:url" content="https://Marper456.github.io/2damasi/documentacion-visor-de-documentos.html"><meta property="og:type" content="article"><link rel="preload" href="https://Marper456.github.io/2damasi/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://Marper456.github.io/2damasi/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://Marper456.github.io/2damasi/assets/css/style.css?v=61f8500cc9bd68cea83f9bcdf6f3474c"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://Marper456.github.io/2damasi/documentacion-visor-de-documentos.html"},"headline":"Documentación Visor de documentos","datePublished":"2025-12-11T23:44+01:00","dateModified":"2026-01-07T18:25+01:00","image":{"@type":"ImageObject","url":"https://Marper456.github.io/2damasi/media/website/documentacion.png","height":512,"width":512},"description":"Herramientas utilizadas: Gemini y Supabase Prompts: 1:Le indicamos que queremos un visor de documentos 2.Le indicamos como queremos que se visualice los archivos xlsx, csv...","author":{"@type":"Person","name":"Mario Pérez Garro","url":"https://Marper456.github.io/2damasi/authors/mario-perez-garro/"},"publisher":{"@type":"Organization","name":"Mario Pérez Garro","logo":{"@type":"ImageObject","url":"https://Marper456.github.io/2damasi/media/website/documentacion.png","height":512,"width":512}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><div class="container"><header class="header"><div class="header__logo"><a class="logo" href="https://Marper456.github.io/2damasi/"><img src="https://Marper456.github.io/2damasi/media/website/documentacion.png" alt="Documentación" width="512" height="512"></a></div></header><main class="content"><article class="post"><header><h1 class="post__title">Documentación Visor de documentos</h1><div class="post__meta"><time datetime="2025-12-11T23:44" class="post__date">December 11, 2025 </time><span class="post__author"><a href="https://Marper456.github.io/2damasi/authors/mario-perez-garro/" class="feed__author">Mario Pérez Garro</a></span></div></header><div class="post__entry"><p>Herramientas utilizadas: Gemini y Supabase</p><p> </p><p><strong><em>Prompts:</em></strong></p><p>1:Le indicamos que queremos un visor de documentos</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12//v1.png" alt="" width="1805" height="819" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12//responsive/v1-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12//responsive/v1-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12//responsive/v1-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12//responsive/v1-lg.png 1024w"></figure><p> </p><p>2.Le indicamos como queremos que se visualice los archivos xlsx, csv...</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v2.png" alt="" width="1793" height="794" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v2-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v2-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v2-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v2-lg.png 1024w"></figure><p> </p><p>3. Le añadimos funciones a cada tipo de archivo y vista previa y de código a los archivos de código</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v3.png" alt="" width="1809" height="790" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v3-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v3-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v3-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v3-lg.png 1024w"></figure><p> </p><p>4.Le indicamos que queremos que sea Wrap los bloques de las tablas de xlsx, csv... y poder editar PDF y arreglar otros errores</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v4.png" alt="" width="1789" height="790" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v4-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v4-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v4-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v4-lg.png 1024w"></figure><p>5.Cambios de nombre al guardar y posibilidad de guardar en el mismo formato</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v5.png" alt="" width="1777" height="772" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v5-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v5-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v5-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v5-lg.png 1024w"></figure><p>6.Añadir opciones de guardado de archivo y visualizacion de imágenes</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v6.png" alt="" width="1734" height="794" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v6-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v6-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v6-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v6-lg.png 1024w"></figure><p>7.Le indicamos que sea un pop up personalizado y no un alert del navegador</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v7.png" alt="" width="1774" height="772" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v7-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v7-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v7-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v7-lg.png 1024w"></figure><p>8.Añadir herramientas de edición para los docx y pdf</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v8.png" alt="" width="1785" height="805" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v8-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v8-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v8-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v8-lg.png 1024w"></figure><p>9.Creamos una alerta de que el documento se muestre con basura binaria</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v11b.png" alt="" width="1777" height="796" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v11b-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v11b-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v11b-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v11b-lg.png 1024w"></figure><p>10.Opciones de Plantillas de UI y modo ciego</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v12.png" alt="" width="1774" height="806" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v12-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v12-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v12-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v12-lg.png 1024w"></figure><p>11.Sustituimos botón de ciegos por multilenguaje</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v13.png" alt="" width="1792" height="796" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v13-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v13-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v13-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v13-lg.png 1024w"></figure><p>12.Implementamos una interfaz de log-in y le idnicamos que cree la conexión con nuestro proyecto de Supabase y le pasamos las creedenciales necesarias(URL del proyecto y clave anónima)</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v14.png" alt="" width="1789" height="842" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v14-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v14-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v14-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v14-lg.png 1024w"></figure><p>13.Le indicamos que guarde los archivos en la caché, de manera local</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v16.png" alt="" width="1777" height="805" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v16-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v16-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v16-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v16-lg.png 1024w"></figure><p>14.Le indicamos que haga un diseño responsive para dispositivos móviles y la posibilidad de ver vídeos</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v17.png" alt="" width="1762" height="806" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v17-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v17-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v17-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v17-lg.png 1024w"></figure><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v18.png" alt="" width="1370" height="855" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v18-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v18-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v18-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v18-lg.png 1024w"></figure><p>15.Añadimos opción de eliminar filas y columnas</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v19-2.png" alt="" width="1790" height="793" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v19-2-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v19-2-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v19-2-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v19-2-lg.png 1024w"></figure><p>16.Le indicamos el nivel de personalización de las plantillas de la UI</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/v20.png" alt="" width="1790" height="806" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/v20-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v20-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v20-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/v20-lg.png 1024w"></figure><p> </p><p> </p><p> </p><p> </p><p><strong><em>Código:</em></strong></p><p><strong>1.Código de gestión de los archivos arrastrados/importados, clasificación según el tipo de archivo y como deben tratarse (uso de librerías o funciones)y guarda en la cache los archivos</strong></p><pre class="language-javascript"><code>addFiles: async (files) =&gt; {
                app.loading(true);
                const imgExts = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg'];
                const vidExts = ['mp4', 'webm', 'ogg', 'mov'];
                for (const file of files) {
                    try {
                        const ext = file.name.split('.').pop().toLowerCase();
                        const doc = {
                            id: state.nextId++, name: file.name, ext: ext,
                            content: '', grid: [], file: file, mode: 'unknown',
                            pdfBuff: null, pdfExtracted: false, colWidths: [],
                            // New properties for images/video
                            zoom: 1, rotation: 0
                        };

                        if (['xlsx', 'xls', 'ods', 'csv'].includes(ext)) { doc.mode = 'excel'; await handlers.excel(doc); } 
                        else if (['docx', 'doc', 'odt', 'rtf'].includes(ext)) { doc.mode = 'word'; await handlers.docx(doc); } 
                        else if (ext === 'pdf') { doc.mode = 'pdf'; doc.pdfBuff = await file.arrayBuffer(); } 
                        else if (['txt'].includes(ext)) { doc.mode = 'word'; await handlers.text(doc); } 
                        else if (imgExts.includes(ext)) { doc.mode = 'image'; await handlers.media(doc); }
                        else if (vidExts.includes(ext)) { doc.mode = 'video'; await handlers.media(doc); }
                        else { doc.mode = 'code'; await handlers.text(doc); }
                        
                        if(doc.content || doc.grid.length &gt; 0 || doc.pdfBuff || doc.mode === 'image' || doc.mode === 'video') {
                            state.docs.push(doc);
                            cache.save(doc); // Save to Cache
                        }
                    } catch (e) { console.error(e); toast(`Error cargando ${file.name}`, 'error'); }
                }
                if (state.docs.length &gt; 0) {
                    app.renderList();
                    app.open(state.docs[state.docs.length - 1].id);
                }
                app.loading(false);
            },</code></pre><p><strong>2.Decide como se mostrará por pantalla según el tipo de archivo y que herramientas mostrar en la barra de tareas</strong></p><p> </p><pre class="language-javascript"><code> open: (id) =&gt; {
                if (state.activeId) app.syncContent();
                state.activeId = id; app.renderList(); app.reset();
                const doc = state.docs.find(d =&gt; d.id === id); if (!doc) return;

                // Close sidebar on mobile when opening a file
                if (window.innerWidth &lt; 768) {
                    const sidebar = document.getElementById('main-sidebar');
                    if (!sidebar.classList.contains('-translate-x-full')) {
                        app.toggleSidebar();
                    }
                }

                document.getElementById('info-type').textContent = doc.ext.toUpperCase();
                document.getElementById('info-stats').textContent = doc.name;

                if (doc.mode === 'excel') {
                    els.excelView.classList.remove('hidden'); renderExcel(doc);
                } else if (doc.mode === 'word') {
                    els.pageContainer.classList.remove('hidden'); els.pageDoc.classList.remove('hidden');
                    els.pageDoc.innerHTML = doc.content;
                } else if (doc.mode === 'pdf') {
                    els.pageContainer.classList.remove('hidden'); els.pdfCtrls.classList.remove('hidden');
                    app.togglePdfView('preview'); 
                } else if (doc.mode === 'image') {
                    els.imageViewer.classList.remove('hidden');
                    els.imageDisplay.src = doc.content;
                    app.applyImageTransform(doc);
                } else if (doc.mode === 'video') {
                    els.videoViewer.classList.remove('hidden');
                    els.videoDisplay.src = doc.content;
                } else {
                    els.codeView.classList.remove('hidden'); els.input.value = doc.content;
                    editor.highlight(doc.ext);
                    const hasPreview = ['html', 'htm', 'md', 'svg', 'java'].includes(doc.ext);
                    els.codeSplit.className = hasPreview ? 'code-split-container' : 'code-split-container code-full-width';
                    editor.sync();
                }
                app.renderToolbar(doc);
            },</code></pre><p><strong>3.Esta función se encarga de que los archivos binarios como docx y xlsx sean capaces de ser trasnformados y manipulados como html legible por el navegador para tratar con este</strong></p><p> </p><pre class="language-javascript"><code>const handlers = {
            text: (doc) =&gt; new Promise(resolve =&gt; {
                const r = new FileReader();
                r.onload = e =&gt; { 
                    const raw = e.target.result;
                    doc.content = doc.mode === 'code' ? raw : `&lt;div class="doc-page"&gt;${raw.split('\n').map(l =&gt; `&lt;p&gt;${l}&lt;/p&gt;`).join('')}&lt;/div&gt;`;
                    resolve(); 
                };
                r.readAsText(doc.file);
            }),
            excel: (doc) =&gt; new Promise(resolve =&gt; {
                const r = new FileReader();
                r.onload = e =&gt; {
                    try {
                        let data = [];
                        if (doc.ext === 'csv') { const res = Papa.parse(e.target.result, {header: false}); data = res.data; }
                        else { const wb = XLSX.read(new Uint8Array(e.target.result), {type: 'array'}); data = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {header: 1, defval: ""}); }
                        doc.grid = data.length ? data : [["",""]]; resolve();
                    } catch(err) { toast('Error leyendo Excel', 'error'); resolve(); }
                };
                if(doc.ext === 'csv') r.readAsText(doc.file); else r.readAsArrayBuffer(doc.file);
            }),
            media: (doc) =&gt; new Promise(resolve =&gt; {
                const r = new FileReader();
                r.onload = e =&gt; {
                    doc.content = e.target.result; // Data URL for image source
                    resolve();
                };
                r.readAsDataURL(doc.file);
            }),
            docx: async (doc) =&gt; {
                if (['doc', 'odt', 'rtf'].includes(doc.ext)) {
                    return new Promise(resolve =&gt; {
                        app.confirmAction(
                            lang.strings[lang.current].WARN_OLD_FORMAT,
                            () =&gt; {
                                const r = new FileReader(); r.readAsText(doc.file, 'ISO-8859-1');
                                r.onload = e =&gt; {
                                     const raw = e.target.result.replace(/&lt;/g, '&amp;lt;').replace(/&gt;/g, '&amp;gt;');
                                     doc.content = `&lt;div class="doc-page"&gt;&lt;pre style="white-space: pre-wrap; font-family: inherit;"&gt;${raw}&lt;/pre&gt;&lt;/div&gt;`;
                                     doc.mode = 'word';
                                     toast(lang.strings[lang.current].WARN_BINARY_LOADED, 'warning'); resolve();
                                };
                            }
                        );
                    });
                }
                try {
                    const ab = await doc.file.arrayBuffer();
                    const res = await mammoth.convertToHtml({arrayBuffer: ab});
                    doc.content = `&lt;div class="doc-page"&gt;${res.value || "&lt;p&gt;Vacío&lt;/p&gt;"}&lt;/div&gt;`;
                } catch(e) { doc.content = "&lt;p&gt;Error&lt;/p&gt;"; toast('Error DOCX', 'error'); }
            }
        };</code></pre><p><strong>4.Permite que los archivos se puedan guardar/exportar en los formatos seleccionados, dependiendo también del tipo de archivo que elijas habrá dispoibles unas importaciones u otras y como estos se reordenan y se organizan para adecuarse al archivo elegido</strong></p><pre class="language-javascript"><code>download: async (format, name) =&gt; {
                const doc = state.docs.find(d =&gt; d.id === state.activeId);
                if(!doc) return;
                
                if(format === doc.ext) format = doc.ext; // Use original format when requested
                const finalName = name.endsWith(`.${format}`) ? name : `${name}.${format}`;

                // --- Special Handling for PDF Source Files ---
                // Ensure text is extracted if user wants to export PDF content to other text formats
                if (doc.mode === 'pdf' &amp;&amp; !doc.pdfExtracted &amp;&amp; format !== 'pdf' &amp;&amp; (format === 'docx' || format === 'txt' || format === 'html')) {
                    app.loading(true);
                    try {
                        const pdf = await pdfjsLib.getDocument({data: doc.pdfBuff.slice(0)}).promise;
                        let extractedText = "";
                        for (let i = 1; i &lt;= pdf.numPages; i++) {
                            const page = await pdf.getPage(i);
                            const content = await page.getTextContent();
                            const items = content.items.map(item =&gt; item.str).join(' ');
                            extractedText += `&lt;p&gt;${items}&lt;/p&gt;&lt;br&gt;`;
                        }
                        doc.content = `&lt;div class="doc-page"&gt;${extractedText || "&lt;p&gt;Sin texto extraíble.&lt;/p&gt;"}&lt;/div&gt;`;
                        doc.pdfExtracted = true;
                        if(els.pageDoc) els.pageDoc.innerHTML = doc.content;
                    } catch(e) { 
                        app.loading(false);
                        return toast('Error al procesar PDF para exportación', 'error'); 
                    }
                    app.loading(false);
                }

                if (format === 'pdf') {
                    if (doc.mode === 'pdf' &amp;&amp; !doc.pdfExtracted) { // Download original PDF binary
                        const blob = new Blob([doc.pdfBuff], {type: 'application/pdf'});
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a'); a.href = url; a.download = finalName; document.body.appendChild(a); a.click();
                    } else if (doc.mode === 'image' || doc.mode === 'video') {
                        const a = document.createElement('a'); a.href = doc.content; a.download = finalName; document.body.appendChild(a); a.click();
                    } else { // Export current visible/edited content to PDF
                        const el = doc.mode === 'excel' ? els.excelView : (doc.mode === 'word' || (doc.mode === 'pdf' &amp;&amp; doc.pdfExtracted) ? els.pageDoc : document.querySelector('.editor-container-inner'));
                        const opt = { margin: 0, filename: finalName, image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } };
                        html2pdf().set(opt).from(el).save();
                    }
                } 
                else if (format === 'html') {
                    let content = "";
                    if (doc.mode === 'word' || doc.mode === 'pdf') {
                        // Styled HTML export for documents
                        content = `&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset="utf-8"&gt;&lt;title&gt;${name}&lt;/title&gt;&lt;style&gt;body { background: #525659; display: flex; justify-content: center; padding: 20px; font-family: sans-serif; } .doc-page { background: white; width: 210mm; min-height: 297mm; padding: 2.54cm; box-shadow: 0 10px 15px rgba(0,0,0,0.1); color: #0f172a; line-height: 1.5; margin: 0 auto; }&lt;/style&gt;&lt;/head&gt;&lt;body&gt;${doc.content}&lt;/body&gt;&lt;/html&gt;`;
                    } else {
                        content = (doc.mode === 'code') ? doc.content : `&lt;pre&gt;${doc.content}&lt;/pre&gt;`;
                    }
                    downloadBlob(content, finalName, 'text/html');
                }
                // New logic to handle original binary files correctly (e.g. DOCX re-download)
                else if (format === doc.ext &amp;&amp; doc.file) {
                    const url = URL.createObjectURL(doc.file);
                    const a = document.createElement('a'); a.href = url; a.download = finalName; document.body.appendChild(a); a.click();
                }
                else if (format === 'docx' || format === 'doc') {
                    // Export HTML as Word-compatible MHTML or HTML with MIME type
                    // Using .doc extension is safer for HTML content opening in Word without warning
                    const safeName = finalName.replace(/\.docx$/, '.doc');
                    const content = `&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset="utf-8"&gt;&lt;/head&gt;&lt;body&gt;${doc.content}&lt;/body&gt;&lt;/html&gt;`;
                    downloadBlob(content, safeName, 'application/msword');
                }
                else if (format === 'csv' || format === doc.ext) { // Handle CSV export when asked for original CSV/Excel
                    if(doc.mode === 'excel') downloadBlob(Papa.unparse(doc.grid), finalName, 'text/csv');
                    else if (doc.mode === 'image' || doc.mode === 'video') {
                        const a = document.createElement('a'); a.href = doc.content; a.download = finalName; document.body.appendChild(a); a.click();
                    }
                }
                else { 
                    // Fallback TXT
                    const textContent = doc.content.replace(/&lt;[^&gt;]*&gt;/g, '\n'); // Simple strip tags
                    downloadBlob(textContent, finalName, 'text/plain'); 
                }
            },</code></pre><p><strong>5.Control de acceso mediante log-in de usuarios mediante Supabase y de gestión de mostrar u ocultar el visor una vez registrado/iniciado sesión o cerrado sesión</strong></p><pre class="language-javascript"><code>const auth = {
            mode: 'login',
            
            hideOverlay: () =&gt; {
                const el = document.getElementById('auth-overlay');
                el.classList.add('hidden');
                el.style.display = 'none'; 
            },

            showOverlay: () =&gt; {
                const el = document.getElementById('auth-overlay');
                el.classList.remove('hidden');
                el.style.display = 'flex';
            },

            init: async () =&gt; {
                const { data: { session } } = await supabase.auth.getSession();
                if (session) {
                    auth.hideOverlay();
                }
                supabase.auth.onAuthStateChange((event, session) =&gt; {
                    if (event === 'SIGNED_IN') {
                        auth.hideOverlay();
                    } else if (event === 'SIGNED_OUT') {
                        auth.showOverlay();
                    }
                });
            },

            switchTab: (mode) =&gt; {
                auth.mode = mode;
                const tabs = document.querySelectorAll('.auth-tab');
                tabs.forEach(t =&gt; t.classList.remove('active'));
                tabs[mode === 'login' ? 0 : 1].classList.add('active');
                
                const btnText = mode === 'login' ? 'Entrar' : 'Registrarse';
                document.getElementById('auth-btn-text').textContent = btnText;
                document.getElementById('auth-error').classList.add('hidden');
            },

            handleSubmit: async (e) =&gt; {
                e.preventDefault();
                const email = document.getElementById('auth-email').value;
                const password = document.getElementById('auth-password').value;
                const errorEl = document.getElementById('auth-error');
                const btn = document.getElementById('auth-submit-btn');
                
                btn.disabled = true;
                btn.classList.add('opacity-70');
                errorEl.classList.add('hidden');

                try {
                    let error = null;
                    if (auth.mode === 'login') {
                        const res = await supabase.auth.signInWithPassword({ email, password });
                        error = res.error;
                    } else {
                        const res = await supabase.auth.signUp({ email, password });
                        error = res.error;
                        if (!error &amp;&amp; res.data.user) {
                            toast('Registro exitoso. ¡Bienvenido!', 'success');
                            if (!res.data.session) auth.hideOverlay();
                        }
                    }

                    if (error) {
                        errorEl.textContent = error.message === 'Invalid login credentials' ? 'Credenciales incorrectas' : error.message;
                        errorEl.classList.remove('hidden');
                    } else if (auth.mode === 'login') {
                          toast('Sesión iniciada', 'success');
                          auth.hideOverlay(); 
                    }
                } catch (err) {
                    errorEl.textContent = "Error de conexión";
                    errorEl.classList.remove('hidden');
                } finally {
                    btn.disabled = false;
                    btn.classList.remove('opacity-70');
                }
            },
            
            logout: async () =&gt; {
                await supabase.auth.signOut();
                window.location.reload();
            }
        };

        auth.init();</code></pre><p><em><strong>Supabase</strong></em></p><p>1.Creamos un proyecto en Supabase, en este caso el llamado: Visor</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/S1.png" alt="" width="1920" height="856" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/S1-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S1-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S1-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S1-lg.png 1024w"></figure><p> </p><p>2.Nos metemos en el menú lateral, Authentication y luego en Sign In/Providers, en nuestro caso, quitamos la opción de código de confirmació de registro y tener habilitado la creación de usuarios nuevos de forma automática(1ra opción), en Auth Providers podremos habilitar varias opciones de autenticación, en este caso, solo email</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/S2.png" alt="" width="1902" height="868" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/S2-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S2-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S2-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S2-lg.png 1024w"></figure><p>3.Vamos a Configuración y cogeremos la url del proyecto que se encuentra en Data API y la clave foranéa, que se encuentra en API Keys y las indicaremos a Gemini que las uses para implementar la conexión entre el código y Supabase</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/S3.png" alt="" width="1899" height="863" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/S3-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S3-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S3-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S3-lg.png 1024w"></figure><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/S4.png" alt="" width="1920" height="841" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/S4-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S4-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S4-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S4-lg.png 1024w"></figure><p> </p><p>4.Finalmente se conectan</p><figure class="post__image"><img loading="lazy" src="https://Marper456.github.io/2damasi/media/posts/12/S5.png" alt="" width="1920" height="815" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://Marper456.github.io/2damasi/media/posts/12/responsive/S5-xs.png 300w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S5-sm.png 480w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S5-md.png 768w, https://Marper456.github.io/2damasi/media/posts/12/responsive/S5-lg.png 1024w"></figure><p> </p><p> </p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on January 7, 2026</p><div class="post__share"></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://Marper456.github.io/2damasi/documentacion-jetson-nano.html" class="btn previous" rel="prev" aria-label="[MISSING TRANSLATION]:  Documentación Jetson nano "><span class="btn__icon">←</span> <span class="btn__text">Documentación Jetson nano</span> </a><a href="https://Marper456.github.io/2damasi/documentacion-novela-grafica.html" class="btn next" rel="next" aria-label="[MISSING TRANSLATION]:  Documentación Novela gráfica "><span class="btn__text">Documentación Novela gráfica</span> <span class="btn__icon">→</span></a></div></nav></article></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p>© 2025 Hecho por <a href="https://marper456.github.io/2damasi/paginas-mario-perez-garro-2.html" target="_blank" rel="noopener">Mario Pérez Garro</a></p></div></div></footer></div><script defer="defer" src="https://Marper456.github.io/2damasi/assets/js/scripts.min.js?v=c2232aa7558e9517946129d2a1b8c770"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>